- name: Create oai config directory
  file:
    path: /usr/local/etc/oai/freeDiameter
    state: directory

- name: Get mme s11 interface
  shell: ifconfig | grep -B1 "inet addr:{{ MME_S11_IP }}" | awk '$1!="inet" && $1!="--" {print $1}'
  args:
    executable: /bin/bash
  register: MME_S11_INTERFACE

- name: Get mme s1mme interface
  shell: ifconfig | grep -B1 "inet addr:{{ MME_S1MME_IP }}" | awk '$1!="inet" && $1!="--" {print $1}'
  args:
    executable: /bin/bash
  register: MME_S1MME_INTERFACE

- name: Overwrite oai epc configs
  template:
    src: "{{item.src}}"
    dest: "{{item.dest}}"
  with_items:
    - { src: 'acl.j2', dest: '/usr/local/etc/oai/freeDiameter/acl.conf' }
    - { src: 'mme_fd.j2', dest: '/usr/local/etc/oai/freeDiameter/mme_fd.conf' }
    - { src: 'mme.j2', dest: '/usr/local/etc/oai/mme.conf' }

- name: Set host name of mme
  hostname:
    name: "{{MME_ALIAS}}"

- name: Set hosts
  lineinfile:
    name: /etc/hosts
    line: "{{item.line}}"
    regexp: "{{item.regex}}"
  with_items:
    - { regex: "{{ HSS_HOST }}", line: '{{ HSS_S6A_IP }} {{ HSS_HOST }} {{ HSS_ALIAS }}' }
    - { regex: "{{ MME_HOST }}", line: '{{ MME_S6A_IP }} {{ MME_HOST }} {{ MME_ALIAS }}'}
